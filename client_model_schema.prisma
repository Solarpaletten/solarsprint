// =============================================================================
// SOLAR SPRINT v0.2.0 — Client Model
// Reverse Engineered from Site.pro by Leanid Kanoplich
// Date: 2026-01-17
// =============================================================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// =============================================================================
// LEVEL 1: TENANT LAYER
// =============================================================================

model Tenant {
  id        String   @id @default(cuid())
  name      String
  plan      String   @default("free")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  users     User[]
  companies Company[]
  clients   Client[]

  @@map("tenants")
}

model User {
  id           String   @id @default(cuid())
  email        String
  name         String?
  passwordHash String
  role         Role     @default(MEMBER)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  tenantId String
  tenant   Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, email])
  @@index([tenantId])
  @@map("users")
}

enum Role {
  OWNER
  ADMIN
  MEMBER
}

// =============================================================================
// LEVEL 2: COMPANY (WORKSPACE) LAYER
// =============================================================================

model Company {
  id          String        @id @default(cuid())
  name        String
  description String?
  status      CompanyStatus @default(ACTIVE)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  tenantId String
  tenant   Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  clients Client[]

  @@index([tenantId])
  @@map("companies")
}

enum CompanyStatus {
  ACTIVE
  FROZEN
  ARCHIVED
}

// =============================================================================
// CLIENT MODEL — REVERSE ENGINEERED FROM SITE.PRO
// =============================================================================

enum LocationType {
  LT   // Local (Lithuania)
  EU   // European Union
  REST // Rest of the world
}

/// Client/Customer - belongs to a Company (Workspace)
/// Full B2B accounting client model with 29 fields
model Client {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ═══════════════════════════════════════════════════════════════════════════
  // REQUIRED FIELDS (3)
  // ═══════════════════════════════════════════════════════════════════════════

  name        String       // Client name
  isJuridical Boolean      // Legal person: true = company, false = individual
  location    LocationType // lt, eu, rest (foreigner status)

  // ═══════════════════════════════════════════════════════════════════════════
  // BASIC INFO
  // ═══════════════════════════════════════════════════════════════════════════

  shortName           String? // Acronym
  code                String? @db.VarChar(20) // Company code (max 20)
  vatCode             String? @db.VarChar(20) // VAT code (max 20)
  businessLicenseCode String? // Individual business license
  email               String?
  phoneNumber         String?
  faxNumber           String?

  // ═══════════════════════════════════════════════════════════════════════════
  // FINANCIAL
  // ═══════════════════════════════════════════════════════════════════════════

  payWithin           Int?     // Payment term in days
  creditSum           Decimal? @db.Decimal(12, 2) // Credit limit
  automaticDebtRemind Boolean? @default(false)

  // ═══════════════════════════════════════════════════════════════════════════
  // REGISTRATION ADDRESS
  // ═══════════════════════════════════════════════════════════════════════════

  registrationCountryCode String?
  registrationCity        String?
  registrationAddress     String?
  registrationZipCode     String?

  // ═══════════════════════════════════════════════════════════════════════════
  // CORRESPONDENCE ADDRESS
  // ═══════════════════════════════════════════════════════════════════════════

  correspondenceCountryCode String?
  correspondenceCity        String?
  correspondenceAddress     String?
  correspondenceZipCode     String?

  // ═══════════════════════════════════════════════════════════════════════════
  // BANKING
  // ═══════════════════════════════════════════════════════════════════════════

  bankAccount   String? // IBAN
  bankName      String?
  bankCode      String?
  bankSwiftCode String? // SWIFT/BIC

  // ═══════════════════════════════════════════════════════════════════════════
  // PERSONAL (for individuals, not companies)
  // ═══════════════════════════════════════════════════════════════════════════

  birthday     DateTime?
  residentCode String? // Foreign taxpayer ID

  // ═══════════════════════════════════════════════════════════════════════════
  // OTHER
  // ═══════════════════════════════════════════════════════════════════════════

  notes              String? @db.Text
  contactInformation String? @db.Text

  // ═══════════════════════════════════════════════════════════════════════════
  // MULTI-TENANT RELATIONS
  // ═══════════════════════════════════════════════════════════════════════════

  // Level 2: Company (Workspace)
  companyId String
  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  // Level 1: Tenant (for direct queries)
  tenantId String
  tenant   Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  // ═══════════════════════════════════════════════════════════════════════════
  // INDEXES
  // ═══════════════════════════════════════════════════════════════════════════

  @@index([companyId])
  @@index([tenantId])
  @@index([email])
  @@index([code])
  @@index([vatCode])
  @@map("clients")
}
