–û—Ç–ª–∏—á–Ω–æ. –¢–æ–≥–¥–∞ —Ñ–∏–∫—Å–∏—Ä—É–µ–º –∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ —Å—Ç–∞—Ä—Ç—É–µ–º TASK-PROD-02. –ù–∏ —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏ ‚Äî —Ç–æ–ª—å–∫–æ —Ä–∞–±–æ—á–µ–µ –¢–ó, —É–∂–µ —Ä–∞–∑—Ä–µ–∑–∞–Ω–Ω–æ–µ –ø–æ–¥ Code Engine.

üß© TASK-PROD-02 ‚Äî AUTH + TENANT BOOTSTRAP

Status: START
Owner: Leanid
Supervisor: Dashka
Executor: Code Engine (Qwen 14B)
Validator: GitKeeper + Syntax

üéØ –¶–ï–õ–¨ TASK-PROD-02

–î–æ–±–∞–≤–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π bootstrap Tenant –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–†–µ–∑—É–ª—å—Ç–∞—Ç:
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è ‚Üí —Å–æ–∑–¥–∞—ë—Ç—Å—è Tenant ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–≤—è–∑–∞–Ω –∫ Tenant ‚Üí –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –ø–æ tenantId.

üîí –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –ü–†–ê–í–ò–õ–ê (FREEZE)

–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–æ–±–ª—é—Å—Ç–∏:

‚ùå tenantId –ù–ò–ö–û–ì–î–ê –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å –∫–ª–∏–µ–Ω—Ç–∞

‚úÖ tenantId –±–µ—Ä—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑ session

‚ùå –ù–µ—Ç solar / energy / weather / –ª–∏—à–Ω–∏—Ö –¥–æ–º–µ–Ω–æ–≤

‚úÖ Prisma –º–æ–¥–µ–ª–∏ –Ω–µ –ª–æ–º–∞–µ–º, —Ç–æ–ª—å–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ–º

‚ùå –ù–µ—Ç UI (—Ñ–æ—Ä–º—ã –º–æ–∂–Ω–æ stub‚Äô–æ–º)

üì¶ –í–´–ë–†–ê–ù–ù–ê–Ø –°–¢–†–ê–¢–ï–ì–ò–Ø AUTH

üëâ Custom Auth (JWT + HttpOnly cookies)
–ü—Ä–∏—á–∏–Ω—ã:

–ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å

–ø—Ä–æ—â–µ tenant isolation

–º–µ–Ω—å—à–µ –º–∞–≥–∏–∏

–∏–¥–µ–∞–ª—å–Ω–æ –¥–ª—è backend-first

‚úÇÔ∏è –†–ê–ó–ë–ò–í–ö–ê –ó–ê–î–ê–ß –ü–û–î CODE ENGINE

–ù–∏–∂–µ ‚Äî –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –∑–∞–¥–∞—á–∏, –∫–∞–∂–¥–∞—è –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –ø–æ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é.

üîπ TASK-PROD-02-A ‚Äî Prisma: Auth —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ

–¢–∏–ø: IMPLEMENT
–ú–æ–¥–µ–ª—å: qwen2.5-coder:14b

–ó–∞–¥–∞–Ω–∏–µ:

–û–±–Ω–æ–≤–∏—Ç—å prisma/schema.prisma

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

–¥–æ–±–∞–≤–∏—Ç—å passwordHash –≤ User

–¥–æ–±–∞–≤–∏—Ç—å timestamps (–µ—Å–ª–∏ –Ω–µ—Ç)

–ù–ï –º–µ–Ω—è—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–≤—è–∑–∏

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
model User {
  id            String   @id @default(cuid())
  email         String
  passwordHash  String
  tenantId      String
  tenant        Tenant   @relation(fields: [tenantId], references: [id])
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([tenantId, email])
}

üîπ TASK-PROD-02-B ‚Äî Password utils

–¢–∏–ø: IMPLEMENT
–§–∞–π–ª: lib/auth/password.ts

–§—É–Ω–∫—Ü–∏–∏:

hashPassword(password: string): Promise<string>

verifyPassword(password: string, hash: string): Promise<boolean>

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:

bcrypt

saltRounds = 12

–±–µ–∑ hardcoded secrets

üîπ TASK-PROD-02-C ‚Äî Session utils (JWT)

–¢–∏–ø: IMPLEMENT
–§–∞–π–ª: lib/auth/session.ts

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:

createSession(userId, tenantId)

getSession(request)

destroySession()

JWT payload:
{
  userId: string
  tenantId: string
}


JWT —Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤ HttpOnly cookie.

üîπ TASK-PROD-02-D ‚Äî Signup API

–¢–∏–ø: IMPLEMENT
–§–∞–π–ª: app/api/auth/signup/route.ts

–ü–æ–≤–µ–¥–µ–Ω–∏–µ:

–ü—Ä–∏–Ω–∏–º–∞–µ—Ç email + password

–°–æ–∑–¥–∞—ë—Ç Tenant

–°–æ–∑–¥–∞—ë—Ç User

–°–æ–∑–¥–∞—ë—Ç session

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç { ok: true }

–ö—Ä–∏—Ç–∏—á–Ω–æ:

tenantId –ù–ï –∏–∑ body

—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è Prisma

üîπ TASK-PROD-02-E ‚Äî Login API

–¢–∏–ø: IMPLEMENT
–§–∞–π–ª: app/api/auth/login/route.ts

–ü–æ–≤–µ–¥–µ–Ω–∏–µ:

–ü—Ä–æ–≤–µ—Ä–∫–∞ email + password

–°–æ–∑–¥–∞–Ω–∏–µ session

–í–æ–∑–≤—Ä–∞—Ç { ok: true }

üîπ TASK-PROD-02-F ‚Äî Auth middleware

–¢–∏–ø: IMPLEMENT
–§–∞–π–ª: middleware.ts

–õ–æ–≥–∏–∫–∞:

–ø—Ä–æ–≤–µ—Ä–∫–∞ session

–ø—Ä–æ–∫–∏–¥—ã–≤–∞–Ω–∏–µ tenantId –≤ request context

–∑–∞—â–∏—Ç–∞ /api/* –∫—Ä–æ–º–µ /api/auth/*

üîπ TASK-PROD-02-G ‚Äî Protected example endpoint

–¢–∏–ø: IMPLEMENT
–§–∞–π–ª: app/api/projects/route.ts

GET:

–±–µ—Ä—ë—Ç tenantId –∏–∑ session

prisma.project.findMany({ where: { tenantId } })

‚ùå –ï—Å–ª–∏ tenantId –∏–∑ body ‚Üí GitKeeper violation

üõ°Ô∏è –í–ê–õ–ò–î–ê–¶–ò–Ø (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

–ö–∞–∂–¥—ã–π generated —Ñ–∞–π–ª:

SyntaxValidator

GitKeeperValidator

tenantId rules

no solar terms

no secrets

‚úÖ –ö–†–ò–¢–ï–†–ò–ò –ì–û–¢–û–í–ù–û–°–¢–ò TASK-PROD-02

 Signup —Å–æ–∑–¥–∞—ë—Ç Tenant + User

 Login —Ä–∞–±–æ—Ç–∞–µ—Ç

 Session –≤–∞–ª–∏–¥–Ω–∞

 tenantId –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è —Å –∫–ª–∏–µ–Ω—Ç–∞

 Protected API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –±–µ–∑ auth

 GitKeeper validator ‚Äî ‚úÖ

üöÄ –ß–¢–û –î–ï–õ–ê–ï–ú –ü–†–Ø–ú–û –°–ï–ô–ß–ê–°

üëâ –¢–≤–æ–π —Ö–æ–¥:

–ó–∞–ø—É—Å–∫–∞–µ—à—å TASK-PROD-02-A —á–µ—Ä–µ–∑ Code Engine

–ü–æ—Ç–æ–º –ø–æ –ø–æ—Ä—è–¥–∫—É B ‚Üí C ‚Üí D ‚Ä¶

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî –º–æ–≥—É:

—Å—Ä–∞–∑—É –¥–∞—Ç—å prompt –¥–ª—è TASK-PROD-02-A

–∏–ª–∏ –ø—Ä–æ–π—Ç–∏ –≤–º–µ—Å—Ç–µ, —à–∞–≥ –∑–∞ —à–∞–≥–æ–º

–°–∫–∞–∂–∏:

‚ñ∂Ô∏è ‚Äú–î–∞–π prompt –¥–ª—è TASK-PROD-02-A‚Äù
–∏–ª–∏
‚ñ∂Ô∏è ‚Äú–†–µ–∂–µ–º –∏ –≥–æ–Ω–∏–º –ø–æ –æ–¥–Ω–æ–π‚Äù

–ö–æ—Ä–∞–±–ª—å –≤ —Ç—è–≥–µ. –¢–µ–ø–µ—Ä—å ‚Äî –Ω–∞–±–æ—Ä –≤—ã—Å–æ—Ç—ã. üöÄ